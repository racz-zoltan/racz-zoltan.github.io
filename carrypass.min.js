const MAX_CALLS_PER_MINUTE=5;const RATE_LIMIT_WINDOW=60*1e3;let callTimes=[];function isRateLimited(){const t=Date.now();callTimes=callTimes.filter(e=>t-e<RATE_LIMIT_WINDOW);return callTimes.length>=MAX_CALLS_PER_MINUTE}function updateCounter(){callTimes.push(Date.now())}function enforceDigitInput(e){const t=document.getElementById(e);if(!t)return;t.addEventListener("input",function(){this.value=this.value.replace(/[^0-9]/g,"")})}enforceDigitInput("iterationCount");const CHARSETS={alphaNumeric:"s5zX7K9tHy5CkE2I8RvQcYfOu1M8Wr42eG3gZxDq6aFbhT4jJi3LN0lAUpP7nwB6VdoS",numericAlpha:"n0tHyaFX4GvE3IZ2qYf8WP1cKuC5s7Bw6jJi3L9RzDaVQp7oYlAM86gSdE42rXbKTU9x5ZDfGq1eC",alphaOnly:"cOpMniQyTmSvwklVJuIjgKtNrLEoRhXYZqaxiHdsPWzDfUeGbAFB",lowerAlpha:"qazxswedcvfrtgbnhyujmkilopgfdwrtmnbvcxqsapluhokjyezi",numbers:"7294053861",special:"QP}v7$D6{+[(Cw^,e5&@uB^Jq.]Gd4=VLuPYN5o;Hk*WgF_a4Xh!lbczr8]Z2Iy9(R03N-1tA<EjSM|)iOT2sfxK>mU1%`:n?"};function pbkdf2Hash(e,t,n,o=1e5){return CryptoJS.PBKDF2(e,t,{keySize:n/4,iterations:o,hasher:CryptoJS.algo.SHA256})}function deterministicInsert(e,t,n){const o=n.charCodeAt(0)%e.length;return e.slice(0,o)+t+e.slice(o+1)}function formatKey(o,e,a,r=[],t=""){let l="",s={};for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);l+=t;r.forEach(e=>s[e]||=new RegExp(e).test(t))}if(r.length&&!r.every(e=>s[e])){if(!s["[a-z]"])l=deterministicInsert(l,"g",t);if(!s["[A-Z]"])l=deterministicInsert(l,"T",t);if(!s["[0-9]"])l=deterministicInsert(l,"4",t);if(!s["[!@#$%^&*()-_=+[]{}|;:,.<>?]"])l=deterministicInsert(l,"!",t)}return l.slice(0,e)}function segmentKey(e,t=7){let n="",o=0;while(o+t<e.length){n+=e.slice(o,o+t)+"-";o+=t}return n+e.slice(o)}function generateRandomPasswordKey(e,t,n,o,a){const r=formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.alphaNumeric,["[a-z]","[A-Z]","[0-9]"],t);return segmentKey(r,7)}function generateRandomLetterKey(e,t,n,o,a){return formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.alphaOnly,["[a-z]","[A-Z]"],t)}function generateRandomUsername(e,t,n,o,a){return formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.lowerAlpha,[],t)}function generateRandomNumberKey(e,t,n,o,a){return formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.numbers,[],t)}function generateRandomMixedKey(e,t,n,o,a){return formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.numericAlpha,["[a-z]","[A-Z]","[0-9]"],t)}function generateRandomSpecialKey(e,t,n,o,a){return formatKey(pbkdf2Hash(e+t,o,a,n),a,CHARSETS.special,["[a-z]","[A-Z]","[0-9]","[!@#$%^&*()-_=+[]{}|;:,.<>?]"],t)}function bytesToAlphaNumericString(o){let a="s5zX7K9tHy5CkE2I8RvQcYfOu1M8Wr42eG3gZxDq6aFbhT4jJi3LN0lAUpP7nwB6VdoS";let r="";let l=false;let s=false;let d=false;for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);if(!l&&/[a-z]/.test(t)){l=true}else if(!s&&/[A-Z]/.test(t)){s=true}else if(!d&&/[0-9]/.test(t)){d=true}r+=t}if(!(l&&s&&d)){return bytesToAlphaNumericString(o)}return r}function bytesToNumericAlphaString(o){let a="n0tHyaFX4GvE3IZ2qYf8WP1cKuC5s7Bw6jJi3L9RzDaVQp7oYlAM86gSdE42rXbKTU9x5ZDfGq1eC";let r="";let l=false;let s=false;let d=false;for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);if(!l&&/[a-z]/.test(t)){l=true}else if(!s&&/[A-Z]/.test(t)){s=true}else if(!d&&/[0-9]/.test(t)){d=true}r+=t}if(!(l&&s&&d)){return bytesToNumericAlphaString(o)}return r}function bytesToAlphaString(o){let a="cOpMniQyTmSvwklVJuIjgKtNrLEoRhXYZqaxiHdsPWzDfUeGbAFB";let r="";let l=false;let s=false;for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);if(!l&&/[a-z]/.test(t)){l=true}else if(!s&&/[A-Z]/.test(t)){s=true}r+=t}if(!(l&&s)){return bytesToAlphaString(o)}return r}function bytesToLowerAlphaString(o){let a="qazxswedcvfrtgbnhyujmkilopgfdwrtmnbvcxqsapluhokjyezi";let r="";for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);r+=t}return r}function bytesToMoreSpecialString(o){let a="QP}v7$D6{+[(Cw^,e5&@uB^Jq.]Gd4=VLuPYN5o;Hk*WgF_a4Xh!lbczr8]Z2Iy9(R03N-1tA<EjSM|)iOT2sfxK>mU1%`:n?";let r="";let l=false;let s=false;let d=false;let c=false;for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);if(!l&&/[a-z]/.test(t)){l=true}else if(!s&&/[A-Z]/.test(t)){s=true}else if(!d&&/[0-9]/.test(t)){d=true}else if(!c&&/[!@#$%^&*()-_=+[\]{}|;:,.<>?]/.test(t)){c=true}r+=t}if(!(l&&s&&d&&c)){return bytesToMoreSpecialString(o)}return r}function bytesToNumericString(o){let a="7294053861";let r="";for(let n=0;n<o.words.length*4;n++){let e=o.words[Math.floor(n/4)]>>24-n%4*8&255;let t=a.charAt(e%a.length);r+=t}return r}async function generateKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;var n=document.getElementById("length").value;var o=document.getElementById("iterationCount").value;const a=document.getElementById("alert-container")||document.body;if(e==""||t==""||n==""||o==""){showAlert("Input fields cannot be empty.","info",a);return}if(n<1){showAlert("Length has to be larger than 0.","info",a);return}if(o<1){showAlert("Iteration has to be larger than 0.","info",a);return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let r=document.getElementById("webAddress").value;let l=document.getElementById("password").value;let s=document.getElementById("iterationCount").value;let d=document.getElementById("salt").value;let c=document.getElementById("length").value;let i=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let u=s.toString();let m=u+l+d+r;let y=generateNumbers(m);for(let t=0;t<5;t++){let e=generateRandomPasswordKey(r,l,y[t],d,c);document.getElementById(i[t]).value=e}let g=generateRandomPasswordKey(r,l,s,d,c);document.getElementById("mainPassword").value=g;generatePasswordAndTrigger(g);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+r+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}function generateNumbers(e){const t=e.toString();const n=CryptoJS.SHA256(t);const o=n.toString(CryptoJS.enc.Hex).match(/.{1,10}/g).slice(0,5);const a=o.map(e=>{const t=parseInt(e,16);let n=t%40001+3e4;if(n>7e4){n-=1e4}return n});return a}async function generateAlphaNumKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;var n=document.getElementById("length").value;var o=document.getElementById("iterationCount").value;const a=document.getElementById("alert-container")||document.body;if(e==""||t==""||n==""||o==""){showAlert("Input fields cannot be empty.","info",a);return}if(n<1){showAlert("Length has to be larger than 0.","info",a);return}if(o<1){showAlert("Iteration has to be larger than 0.","info",a);return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let r=document.getElementById("webAddress").value;let l=document.getElementById("password").value;let s=document.getElementById("iterationCount").value;let d=document.getElementById("salt").value;let c=document.getElementById("length").value;let i=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let u=s.toString();let m=u+l+d+r;let y=generateNumbers(m);for(let t=0;t<5;t++){let e=generateRandomMixedKey(r,l,y[t],d,c);document.getElementById(i[t]).value=e}let g=generateRandomMixedKey(r,l,s,d,c);document.getElementById("mainPassword").value=g;generatePasswordAndTrigger(g);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+r+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}async function generateLetterKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;var n=document.getElementById("length").value;var o=document.getElementById("iterationCount").value;const a=document.getElementById("alert-container")||document.body;if(e==""||t==""||n==""||o==""){showAlert("Input fields cannot be empty.","info",a);return}if(n<1){showAlert("Length has to be larger than 0.","info",a);return}if(o<1){showAlert("Iteration has to be larger than 0.","info",a);return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let r=document.getElementById("webAddress").value;let l=document.getElementById("password").value;let s=document.getElementById("iterationCount").value;let d=document.getElementById("salt").value;let c=document.getElementById("length").value;let i=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let u=s.toString();let m=u+l+d+r;let y=generateNumbers(m);for(let t=0;t<5;t++){let e=generateRandomLetterKey(r,l,y[t],d,c);document.getElementById(i[t]).value=e}let g=generateRandomLetterKey(r,l,s,d,c);document.getElementById("mainPassword").value=g;generatePasswordAndTrigger(g);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+r+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}async function generateUsername(){let e=document.getElementById("webAddress").value;let t=document.getElementById("password").value;let n=document.getElementById("iterationCount").value;let o=document.getElementById("salt").value;let a=14;let r=generateRandomUsername(e,t,n,o,a);document.getElementById("username").value=r}async function generateNumberKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;var n=document.getElementById("length").value;var o=document.getElementById("iterationCount").value;const a=document.getElementById("alert-container")||document.body;if(e==""||t==""||n==""||o==""){showAlert("Input fields cannot be empty.","info",a);return}if(n<1){showAlert("Length has to be larger than 0.","info",a);return}if(o<1){showAlert("Iteration has to be larger than 0.","info",a);return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let r=document.getElementById("webAddress").value;let l=document.getElementById("password").value;let s=document.getElementById("iterationCount").value;let d=document.getElementById("salt").value;let c=document.getElementById("length").value;let i=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let u=s.toString();let m=u+l+d+r;let y=generateNumbers(m);for(let t=0;t<5;t++){let e=generateRandomNumberKey(r,l,y[t],d,c);document.getElementById(i[t]).value=e}let g=generateRandomNumberKey(r,l,s,d,c);document.getElementById("mainPassword").value=g;generatePasswordAndTrigger(g);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+r+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}async function generateMixedKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let n=document.getElementById("webAddress").value;let o=document.getElementById("password").value;let e=document.getElementById("iterationCount").value;let a=document.getElementById("salt").value;let r=document.getElementById("length").value;let l=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let t=e.toString();let s=t+o+a+n;let d=generateNumbers(s);for(let t=0;t<5;t++){let e=generateRandomMixedKey(n,o,d[t],a,r);document.getElementById(l[t]).value=e}let c=generateRandomMixedKey(n,o,e,a,r);document.getElementById("mainPassword").value=c;generatePasswordAndTrigger(c);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+n+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}async function generateSpecialKey(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;var n=document.getElementById("length").value;var o=document.getElementById("iterationCount").value;const a=document.getElementById("alert-container")||document.body;if(e==""||t==""||n==""||o==""){showAlert("Input fields cannot be empty.","info",a);return}if(n<1){showAlert("Length has to be larger than 0.","info",a);return}if(o<1){showAlert("Iteration has to be larger than 0.","info",a);return}generateWithMaster();showLoadingDots();await new Promise(e=>setTimeout(e,200));let r=document.getElementById("webAddress").value;let l=document.getElementById("password").value;let s=document.getElementById("iterationCount").value;let d=document.getElementById("salt").value;let c=document.getElementById("length").value;let i=["supplementaryone","supplementarytwo","supplementarythree","supplementaryfour","supplementaryfive"];let u=s.toString();let m=u+l+d+r;let y=generateNumbers(m);for(let t=0;t<5;t++){let e=generateRandomSpecialKey(r,l,y[t],d,c);document.getElementById(i[t]).value=e}let g=generateRandomSpecialKey(r,l,s,d,c);document.getElementById("mainPassword").value=g;generatePasswordAndTrigger(g);generateUsername();document.getElementById("createdfor").innerHTML="for "+"<b>"+r+"</b>";document.getElementById("webAddress").value="";document.getElementById("password").value="";document.getElementById("iterationCount").value="";document.getElementById("salt").value="";document.getElementById("length").value="";updateCounter();hideLoadingDots();resetTimer()}async function encryptTextWithPassword(e,t){const{salt:n,iv:o}=await deriveAesParamsFromPassword(t);const a=await crypto.subtle.importKey("raw",(new TextEncoder).encode(t),"PBKDF2",false,["deriveKey"]);const r=await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-512"},a,{name:"AES-GCM",length:256},false,["encrypt"]);const l=(new TextEncoder).encode(e);const s=await crypto.subtle.encrypt({name:"AES-GCM",iv:o},r,l);return btoa(String.fromCharCode(...new Uint8Array(s)))}async function decryptTextWithPassword(e,t){const{salt:n,iv:o}=await deriveAesParamsFromPassword(t);const a=await crypto.subtle.importKey("raw",(new TextEncoder).encode(t),"PBKDF2",false,["deriveKey"]);const r=await crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:1e5,hash:"SHA-512"},a,{name:"AES-GCM",length:256},false,["decrypt"]);const l=Uint8Array.from(atob(e),e=>e.charCodeAt(0));const s=await crypto.subtle.decrypt({name:"AES-GCM",iv:o},r,l);return(new TextDecoder).decode(s)}async function encryptText(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}let e=document.getElementById("plaintext").value;let t=document.getElementById("encryptionPassword").value;const n=document.getElementById("alert-container")||document.body;if(!t.trim()){showModal("Password input field cannot be empty.");return}try{const a=await encryptTextWithPassword(e,t);document.getElementById("encryptedText").value=a;document.getElementById("plaintext").value="";document.getElementById("encryptionPassword").value=""}catch(o){showModal("Encryption failed. Please try again.")}document.getElementById("encrypted").scrollIntoView({behavior:"smooth",block:"start"});updateCounter();resetTimer()}function copyEncryptedText(){let e=document.getElementById("encryptedText").value;const t=document.getElementById("alert-container")||document.body;copyToClipboard(e);showAlert("Encrypted text copied to clipboard.","success",t)}async function decryptText(){if(isRateLimited()){showModal("You have exceeded the rate limit. Please try again later.");return}let t=document.getElementById("encryptedText").value;let n=document.getElementById("decryptionPassword").value;const e=document.getElementById("alert-container")||document.body;if(!n.trim()){showModal("Password input field cannot be empty.");return}try{let e=await decryptTextWithPassword(t,n);if(e){document.getElementById("plaintext").value=e;document.getElementById("encryptedText").value="";document.getElementById("decryptionPassword").value=""}else{showModal("Decryption failed: incorrect password.")}}catch(o){showModal("Decryption failed. Please check your password and try again.")}document.getElementById("start").scrollIntoView({behavior:"smooth",block:"start"});updateCounter();resetTimer()}function copyDecryptedText(){let e=document.getElementById("plaintext").value;const t=document.getElementById("alert-container")||document.body;copyToClipboard(e);showAlert("Decrypted text copied to clipboard.","success",t)}async function copyToClipboard(e){try{await navigator.clipboard.writeText(e)}catch(t){showModal("Failed to copy text to clipboard.")}}function copyInputValue(e){const t=document.getElementById(e.name);const n=document.getElementById("copySuccessIcon-"+e.getAttribute("data-password-id"));navigator.clipboard.writeText(t.value).then(()=>{n.style.display="inline";n.innerHTML='<i data-lucide="copy-check" style="color: green; font-size: 18px;"></i>';lucide.createIcons();resetTimer();setTimeout(()=>{n.style.display="none"},2e3)})["catch"](e=>{console.error("Error copying text: ",e)})}function showAlert(e,t="info",n=document.body){const o=document.createElement("div");o.className=`custom-alert custom-alert-${t}`;o.innerHTML=`
    <span>${e}</span>
    <button class="custom-alert-close" onclick="this.parentElement.remove()">×</button>
  `;n.prepend(o);setTimeout(()=>{o.remove()},4e3)}function generateWithMaster(){var e=document.getElementById("webAddress").value;var t=document.getElementById("password").value;const n=document.getElementById("alert-container")||document.body;var o=e+t;var a="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";if(e!=""&&t!=""){while(o.length<32){o+=o}o=o.slice(0,32)}else{showAlert("Application name and Master password input fields cannot be empty.","info",n)}var r=btoa(o);var l="";for(var s=0;s<r.length;s++){var d=r.charAt(s);if(d!=="="){var c=d.charCodeAt(0);if(c===43)c=62;else if(c===47)c=63;l+=a[c>>2];l+=a[(c&3)<<3|r.charCodeAt(++s)>>5];l+=a[r.charCodeAt(s)&31]}}l=l.slice(0,32);document.getElementById("salt").value=l;document.getElementById("keyGeneratorForm").addEventListener("submit",function(e){e.preventDefault()})}function showMaster(){var e=document.getElementById("password");var t=document.getElementById("showbutton");if(e.type=="password"){t.textContent="Hide";e.setAttribute("type","text")}else{t.textContent="Show";e.setAttribute("type","password")}}function showManyPassword(e){const t=e.name;const n=document.getElementById(t);if(!n){showAlert(`No field found for: ${t}`,"error");return}if(n.type==="password"){n.type="text";e.textContent="Hide"}else{n.type="password";e.textContent="Show"}}function clearAllPassword(){document.getElementById("mainPassword").value="";document.getElementById("supplementaryone").value="";document.getElementById("supplementarytwo").value="";document.getElementById("supplementarythree").value="";document.getElementById("supplementaryfour").value="";document.getElementById("supplementaryfive").value="";document.getElementById("username").value="";document.getElementById("createdfor").innerHTML="";generatePasswordAndTrigger("")}if("serviceWorker"in navigator){window.addEventListener("load",function(){navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)},function(e){console.error("ServiceWorker registration failed: ",e)})})}async function deriveAesParamsFromPassword(e){const t=new TextEncoder;const n=e.padEnd(64,e).slice(0,64).toUpperCase();const o=await crypto.subtle.digest("SHA-512",t.encode(n));const a=new Uint8Array(o);const r=a.slice(0,16);const l=a.slice(16,28);return{salt:r,iv:l}}async function encryptFile(){showPasscodeModal();const e=await new Promise(n=>{document.getElementById("submitPassCode").addEventListener("click",async()=>{const e=document.getElementById("passCodeInput").value;const t=await decryptPasscode(e);if(t){localStorage.setItem("lastAccessTime",Date.now().toString());hidePasscodeModal();document.getElementById("passCodeInput").value="";n(true)}else{document.getElementById("passCodeInput").value="";document.getElementById("errorMessage").innerText="Invalid passcode. Please try again.";n(false)}})});if(!e){return}resetSessionTimer();const t=document.getElementById("fileInput");const u=document.getElementById("password1").value;const n=document.getElementById("alert-container")||document.body;if(!t.files.length||!u.trim())return showModal("Please select a file and enter a password.");const m=t.files[0];const y=new FileReader;y.onload=async function(){try{const{salt:t,iv:n}=await deriveAesParamsFromPassword(u);const o=await crypto.subtle.importKey("raw",(new TextEncoder).encode(u),"PBKDF2",false,["deriveKey"]);const a=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-512"},o,{name:"AES-GCM",length:256},false,["encrypt"]);const r=await crypto.subtle.encrypt({name:"AES-GCM",iv:n},a,y.result);const l=new Blob([r],{type:m.type});const s=m.name.replace(/\.[^/.]+$/,"")+"[encrypted]"+m.name.substring(m.name.lastIndexOf("."));const d=URL.createObjectURL(l);const c=document.createElement("a");c.href=d;c.download=s;document.body.appendChild(c);c.click();document.body.removeChild(c);document.getElementById("password1").value="";const e=document.getElementById("fileInput");const i=document.getElementById("fileInputText");e.value="";i.value="Choose file"}catch(e){showModal("Encryption failed. Please try again.")}};y.readAsArrayBuffer(m)}async function decryptFile(){showPasscodeModal();document.getElementById("errorMessage").innerText="";const e=await new Promise(n=>{document.getElementById("submitPassCode").addEventListener("click",async()=>{const e=document.getElementById("passCodeInput").value;const t=await decryptPasscode(e);if(t){localStorage.setItem("lastAccessTime",Date.now().toString());hidePasscodeModal();document.getElementById("passCodeInput").value="";n(true)}else{document.getElementById("errorMessage").innerText="Invalid passcode. Please try again.";document.getElementById("passCodeInput").value=""}})});if(!e){return}resetSessionTimer();const t=document.getElementById("encryptedFileInput");const u=document.getElementById("password2").value;if(!t.files.length||!u.trim())return showModal("Please select a file and enter a password.");const m=t.files[0];const y=new FileReader;y.onload=async function(){try{const{salt:t,iv:n}=await deriveAesParamsFromPassword(u);const o=await crypto.subtle.importKey("raw",(new TextEncoder).encode(u),"PBKDF2",false,["deriveKey"]);const a=await crypto.subtle.deriveKey({name:"PBKDF2",salt:t,iterations:1e5,hash:"SHA-512"},o,{name:"AES-GCM",length:256},false,["decrypt"]);const r=await crypto.subtle.decrypt({name:"AES-GCM",iv:n},a,y.result);const l=new Blob([r],{type:m.type});const s=m.name.replace(/\.[^/.]+$/,"")+"[decrypted]"+m.name.substring(m.name.lastIndexOf("."));const d=URL.createObjectURL(l);const c=document.createElement("a");c.href=d;c.download=s;document.body.appendChild(c);c.click();document.body.removeChild(c);document.getElementById("password2").value="";const e=document.getElementById("encryptedFileInput");const i=document.getElementById("fileInputTextDecrypt");e.value="";i.value="Choose file"}catch(e){showModal("Decryption failed. Incorrect password.");document.getElementById("password2").value=""}};y.readAsArrayBuffer(m)}function updateFileName(){const e=document.getElementById("fileInput");const t=document.getElementById("fileInputText");const n=e.files[0]?e.files[0].name:"Choose file";t.value=n}const fileButton=document.getElementById("fileButton");const fileInput=document.getElementById("fileInput");if(fileButton&&fileInput){fileButton.addEventListener("click",function(){fileInput.click()})}function updateFileNameDecrypt(){const e=document.getElementById("encryptedFileInput");const t=document.getElementById("fileInputTextDecrypt");const n=e.files[0]?e.files[0].name:"Choose file";t.value=n}const fileButtonDecrypt=document.getElementById("fileButtonDecrypt");const encryptedFileInput=document.getElementById("encryptedFileInput");if(fileButtonDecrypt&&encryptedFileInput){fileButtonDecrypt.addEventListener("click",function(){encryptedFileInput.click()})}document.addEventListener("DOMContentLoaded",function(){const e=document.querySelectorAll(".nav-link");e.forEach(function(e){e.addEventListener("click",function(){const e=document.querySelector(".navbar-collapse");if(e.classList.contains("show")){e.classList.remove("show")}})})});function showModal(e){const t=document.getElementById("alertModal");const n=document.getElementById("alertModalMessage");n.textContent=e;t.style.display="block";const o=document.getElementsByClassName("close")[0];o.onclick=function(){t.style.display="none"};window.onclick=function(e){if(e.target===t){t.style.display="none"}}}function showModalWorker(e,t){const n=document.getElementById("myModal");const o=document.getElementById("modalMessage");o.textContent=e;n.style.display="block";const a=document.getElementById("modalConfirm");a.onclick=function(){n.style.display="none";t(true)};const r=document.getElementById("modalCancel");r.onclick=function(){n.style.display="none";t(false)}}function showLoadingDots(){document.getElementById("loadingModal").style.display="block"}function hideLoadingDots(){document.getElementById("loadingModal").style.display="none"}function calculateEntropy(e){if(!e)return 0;const t=getCharsetSize(e);return e.length*Math.log2(t)}function getCharsetSize(e){const t=new Set(e.split(""));return t.size}function updatePasswordStrength(e){const t=document.getElementById("passwordStrengthBar");const n=document.getElementById("passwordStrengthText");const o=document.getElementById("entropyText");let a=0;let r=/[a-z]/.test(e);let l=/[A-Z]/.test(e);let s=/\d/.test(e);let d=/[!@#$%^&*(),.?":{}|<>]/.test(e);if(!e){n.innerText="";t.className="";o.innerText="";n.style.color="blue";return}if(e.length>=12){a++}if(e.length>=17){a++}if(r)a++;if(l)a++;if(s)a++;if(d)a++;const c=calculateEntropy(e);let i=0;let u="Low Entropy";if(c<30){i=1;u="Low Entropy"}else if(c>=30&&c<56){i=2;u="Medium Entropy"}else if(c>=56&&c<85){i=4;u="High Entropy"}else{i=6;u="Extra Strong"}a+=i;o.innerText=`Entropy: ${c.toFixed(2)} (${u})`;let m="Weak";let y="red";if(a<=5){m="Weak";y="red"}else if(a<=8){m="Medium";y="orange"}else if(a<=10){m="Strong";y="green"}else{m="Extra Strong";y="purple"}t.className="";t.classList.add(m.toLowerCase().replace(" ",""));n.innerText=m;n.style.color=y}function generatePasswordAndTrigger(e){document.getElementById("mainPassword").value=e;updatePasswordStrength(e)}function copyPasswordCheck(e){const t=document.getElementById(e.name);const n=document.getElementById("copySuccessIcon-"+e.getAttribute("data-password-id"));navigator.clipboard.writeText(t.value).then(()=>{n.style.display="inline";n.innerHTML='<i data-lucide="copy-check" style="color: green; font-size: 18px;"></i>';lucide.createIcons();setTimeout(()=>{n.style.display="none"},2e3)})["catch"](e=>{console.error("Error copying text: ",e)})}const encryptPasscode=async e=>{const t=new TextEncoder;const n=t.encode(e);const o=await crypto.subtle.digest("SHA-256",n);const a=await crypto.subtle.importKey("raw",o,{name:"AES-GCM"},false,["encrypt","decrypt"]);const r=crypto.getRandomValues(new Uint8Array(12));const l=await crypto.subtle.encrypt({name:"AES-GCM",iv:r},a,o);const s=l.slice(-16);const d=l.slice(0,-16);localStorage.setItem("encryptedPasscode",JSON.stringify({ciphertext:Array.from(new Uint8Array(d)),nonce:Array.from(r),tag:Array.from(new Uint8Array(s))}));localStorage.setItem("lastAccessTime",Date.now().toString())};const decryptPasscode=async e=>{const t=JSON.parse(localStorage.getItem("encryptedPasscode"));if(!t)return false;const{ciphertext:n,nonce:o,tag:a}=t;const r=new TextEncoder;const l=r.encode(e);const s=await crypto.subtle.digest("SHA-256",l);const d=await crypto.subtle.importKey("raw",s,{name:"AES-GCM"},false,["decrypt"]);const c=new Uint8Array(n);const i=new Uint8Array(o);const u=new Uint8Array(a);try{const y=await crypto.subtle.decrypt({name:"AES-GCM",iv:i,additionalData:new Uint8Array,tagLength:128},d,new Uint8Array([...c,...u]));return true}catch(m){return false}};const showPasscodeModal=()=>{const e=document.getElementById("passCodeInput");e.value="";const t=document.getElementById("passCodeModal");t.style.display="block"};const hidePasscodeModal=()=>{const e=document.getElementById("passCodeInput");e.value="";const t=document.getElementById("passCodeModal");t.style.display="none"};const handlePasscodeSubmit=async()=>{const e=document.getElementById("passCodeInput");const t=e.value.trim();if(!localStorage.getItem("encryptedPasscode")){await encryptPasscode(t);hidePasscodeModal()}else{const n=await decryptPasscode(t);if(n){localStorage.setItem("lastAccessTime",Date.now().toString());document.getElementById("passCodeInput").value="";hidePasscodeModal()}else{document.getElementById("errorMessage").innerText="Invalid passcode. Please try again."}}};document.getElementById("submitPassCode").addEventListener("click",handlePasscodeSubmit);const checkSessionTimeout=()=>{const e=parseInt(localStorage.getItem("lastAccessTime"))||0;const t=Date.now();if(t-e>5*60*1e3){showPasscodeModal()}};const resetSessionTimer=()=>{localStorage.setItem("lastAccessTime",Date.now().toString());checkSessionTimeout()};setInterval(checkSessionTimeout,60*1e3);if(!localStorage.getItem("encryptedPasscode")){showPasscodeModal()}const resetTimer=()=>{const e=parseInt(localStorage.getItem("lastAccessTime"))||0;const t=Date.now();if(t-e>5*60*1e3){showPasscodeModal()}else{localStorage.setItem("lastAccessTime",t.toString())}};function switchOff(){const e=Date.now();let t=e-10*60*1e3;localStorage.setItem("lastAccessTime",t.toString());const n=document.getElementById("passCodeInput");n.value="";showPasscodeModal()}window.addEventListener("load",checkSessionTimeout);window.addEventListener("popstate",checkSessionTimeout);window.addEventListener("hashchange",checkSessionTimeout);let deferredPrompt;window.addEventListener("beforeinstallprompt",e=>{e.preventDefault();deferredPrompt=e;const t=document.getElementById("installButton");t.style.display="block";t.addEventListener("click",()=>{deferredPrompt.prompt();deferredPrompt.userChoice.then(e=>{console.log(e.outcome);deferredPrompt=null})})});function handleIOSInstall(){const e=document.createElement("div");e.innerHTML=`
    <div style="position: fixed; bottom: 0; left: 0; width: 100%; background-color: #fff; text-align: center; padding: 10px; font-size: 14px; color: #333;">
      <p>Please add this app to your home screen:</p>
      <p>Tap the "Share" button and select "Add to Home Screen".</p>
    </div>
  `;document.body.appendChild(e)}if(/iPhone|iPad|iPod/.test(navigator.userAgent)&&!window.MSStream){handleIOSInstall()}